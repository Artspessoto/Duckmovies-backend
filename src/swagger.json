{
    "openapi": "3.0.0",
    "info": {
        "title": "Duckmovies",
        "description": "Essa API tem como objetivo o gerenciamento de anotações e categorias de filmes feita por usuários autenticados.",
        "contact": {
            "email": "artspessoto@gmail.com"
        },
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:3333/",
            "description": "API para testes"
        },
        {
            "url": "https://duckmovies-backend.onrender.com",
            "description": "API de produção"
        }
    ],
    "host": "https://duckmovies-backend.onrender.com",
    "externalDocs": {
        "description": "Mais sobre a construção da API",
        "url": "https://sleepy-lion-12c.notion.site/DuckMovies-508dedb0c2be4076be7a69d7386d76dc"
    },
    "paths": {
        "/users": {
            "post": {
                "summary": "Cadastro de usuários",
                "description": "Cria um novo usuário a partir do campos validados name, email e password, que são necessários ao corpo da requisição, com a senha sendo encriptada de forma segura.",
                "tags": [
                    "Users"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/User"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "name": "Arthur",
                                        "email": "arthur@email.com",
                                        "password": "789456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "400": {
                        "description": "Este e-mail já está em uso."
                    },
                    "201": {
                        "description": "Ok"
                    }
                }
            },
            "put": {
                "summary": "Atualiza dados referentes ao usuário",
                "description": "Atualiza dados referentes ao usuário, sendo necessário ser um usuário autenticado para realizar as alterações. Para atualizar seus dados é necessário seu name, email, old_password e password.",
                "tags": [
                    "Users"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UserUpdate"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "name": "Arthur Martins",
                                        "email": "arthur@email.com",
                                        "password": "123456",
                                        "old_password": "789456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "401": {
                        "$ref": "#/components/responses/NotFound"
                    },
                    "400": {
                        "oneOf": [
                            {"$ref": "#/components/responses/InvalidOldPasswordError"}, 
                            {"$ref": "#/components/responses/EmailInUseError"},
                            {"$ref": "#/components/responses/MissingOldPasswordError"} 
                        ]
                    },
                    "200": {
                        "description": "Usuário atualizado com sucesso"
                    }
                }
            }
        },
        "/sessions": {
            "post": {
                "summary": "Cria uma sessão para o usuário",
                "description": "Gera um token para um usuário já cadastrado com tempo de expiração de 1 dia e com a chave secreta, que é usada para verificar e assinar o token, garantindo autenticidade da sessão do usuário na aplicação. Para gerar esse token é necessário que o usuário envie no corpo da requisição os dados de email e password.",
                "tags": [
                    "Sessions"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UserLogin"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "email": "arthur@email.com",
                                        "password": "123456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "401": {
                        "description": "E-mail e/ou senha incorreta"
                    },
                    "200": {
                        "description": "Ok"
                    }
                }
            }
        },
        "/movie_notes": {
            "post": {
                "summary": "Cria anotações relacionadas ao filme feitas por um usuário autenticado",
                "description": "Cria anotações relacionadas ao filme a partir da validação de seu título, descrição, classifição e tags (categorias) relacionadas a ele armazenando a anotação no banco de dados na tabela movie_notes, além de também associar tags informadas à anotação na tabela movie_tags.",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/MovieNote"
                            },
                            "examples": {
                                "movie_note": {
                                    "value": {
                                        "title": "Sharknado",
                                        "description": "Os sobreviventes do primeiro tornado de tubarões são obrigados a se reunir mais uma vez para combater uma nova tempestade de tubarões, que dessa vez ameaça Nova York.",
                                        "rating": 5,
                                        "tags": ["Terror", "Ação", "Comédia"]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Ok"
                    }
                }
            },
            "get": {
                "summary": "Lista as notas sobre os filmes com filtros no título e tags",
                "description": "Lista notas com filtros a partir do título e das tags passadas na URL como parâmetros, chamados de parâmetros de consulta (Query Params).",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/movie_notes/:id": {
            "get": {
                "summary": "Retorna dados das anotações de filmes pelo identificador",
                "description": "Recupera anotações específicas pelo identificador da anotação do filme passado por parâmetro (Route Params). A requisição vai retornar a nota do filme (título, descrição, classificação e as categorias criadas) se for bem sucedida.",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "delete": {
                "summary": "Deleta a nota do filme a partir do seu identificador",
                "description": "A requisição de delete vai apagar a nota do filme a partir do ID passado no parâmetro da rota, deletando também em cascata o que for vinculado a esse ID na tabela movie_tags",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/movie_tags": {
            "get": {
                "summary": "Retorna as tags (categorias de filmes) vinculadas ao usuário autenticado",
                "description": "Recupera as tags vinculadas ao usuário com sessão realizada que fez a solicitação",
                "tags": [ "Movie_tags" ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        }
    },
    "components": {
        "schemas": {
            "User": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                }
            },
            "UserLogin": {
                "type": "object",
                "properties": {
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                }
            },
            "UserUpdate": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "old_password": {
                        "type": "string"
                    }
                }
            },
            "MovieNote": {
                "type": "object",
                "properties": {
                    "title": {
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "rating": {
                        "type": "integer"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "Error": {
                "type": "object",
                "properties": {
                    "status": {
                        "type":"string"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            }
        },
        "responses": {
            "NotFound": {
                "description": "Usuário não encontrado",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "Unauthorized": {
                "description": "JWT Token inválido",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "MissingOldPasswordError": {
                "description": "Você precisa informar a senha antiga para definir a nova senha",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "InvalidOldPasswordError":{
                "description": "A senha antiga não confere",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "EmailInUseError": {
                "description": "Este e-mail já está em uso",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            }
        },
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "scheme": "bearer",
                "bearerFormat": "JWT"
            }
        }
    }
}