{
    "openapi": "3.0.0",
    "info": {
        "title": "Duckmovies ü¶Ü",
        "description": "Esta API tem como objetivo o gerenciamento de anota√ß√µes e categorias de filmes feitas por usu√°rios autenticados. Para autenticar-se, siga os passos abaixo:\n\n1. **Criando um usu√°rio üôç‚Äç‚ôÇÔ∏è:** Acesse o endpoint `/users` com uma requisi√ß√£o POST para criar um novo usu√°rio com nome, email e senha.\n\n2. **Iniciando sess√£o (login) üîë:** Use o endpoint `/sessions` com uma requisi√ß√£o POST para autenticar o usu√°rio rec√©m-criado (login) e obter um token JWT. Esse token √© necess√°rio para autenticar suas requisi√ß√µes subsequentes\n3. **Gerenciando notas de filmes üé•:** Com o token JWT, voc√™ pode acessar os endpoints `/movie_notes` para criar, atualizar e listar notas de filmes.\n4. **Gerenciando tags (categorias) de filmes üçø:** Utilize os endpoints `/movie_tags` para adicionar e listar tags relacionadas √†s notas de filmes.\n5. **Atualizando dados do usu√°rio üñä :** O endpoint `/users` com uma requisi√ß√£o PUT permite atualizar os dados do usu√°rio autenticado.\n6. **Atualizando avatar do usu√°rio üëΩ:** O endpoint `/users/avatar` com uma requisi√ß√£o PATCH permite que voc√™ atualize o avatar do usu√°rio fazendo um upload de imagem da sua m√°quina.\n\n**Observa√ß√£o:** Certifique-se de incluir o token JWT no cabe√ßalho `Authorize` para se autenticar e acessar todas as requisi√ß√µes que requerem autentica√ß√£o üîì.",
        "contact": {
            "email": "artspessoto@gmail.com"
        },
        "version": "1.0.0",
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        }
    },
    "servers": [
        {
            "url": "https://duckmovies-backend.onrender.com",
            "description": "API de produ√ß√£o"
        },
        {
            "url": "http://localhost:3333/",
            "description": "API para testes locais (n√£o acess√≠vel publicamente)"
        }
    ],
    "externalDocs": {
        "description": "Mais sobre a constru√ß√£o da API",
        "url": "https://sleepy-lion-12c.notion.site/DuckMovies-508dedb0c2be4076be7a69d7386d76dc"
    },
    "paths": {
        "/users": {
            "post": {
                "summary": "Cadastro de usu√°rios",
                "description": "Cria um novo usu√°rio a partir do campos validados name, email e password, que s√£o necess√°rios ao corpo da requisi√ß√£o, com a senha sendo encriptada de forma segura.",
                "tags": [
                    "Users"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UserRegister"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "name": "Arthur",
                                        "email": "arthur@email.com",
                                        "password": "123456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "400": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "UsedEmail": {
                                        "summary": "Email em uso",
                                        "value": {
                                            "status": "Error",
                                            "message": "Este e-mail j√° est√° em uso."
                                        }
                                    },
                                    "InvalidEmail": {
                                        "summary": "Formato de email inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "E-mail inv√°lido"
                                        }
                                    },
                                    "ShortName": {
                                        "summary": "Nome precisa ter mais de 1 caractere",
                                        "value": {
                                            "status": "Error",
                                            "message": "Nome muito curto"
                                        }
                                    },
                                    "ShortPassword": {
                                        "summary": "Senha precisa ter mais de 6 caracteres",
                                        "value": {
                                            "status": "Error",
                                            "message": "Senha muito curta"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "201": {
                        "description": "Ok"
                    }
                }
            },
            "put": {
                "summary": "Atualiza dados referentes ao usu√°rio que iniciou uma sess√£o.",
                "description": "Atualiza dados referentes ao usu√°rio, sendo necess√°rio ser um usu√°rio autenticado para realizar as altera√ß√µes. Para atualizar seus dados √© necess√°rio seu name, email, old_password e password.",
                "tags": [
                    "Users"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UserUpdate"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "name": "Arthur Martins",
                                        "email": "arthur@email.com",
                                        "password": "123456",
                                        "old_password": "123456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "404": {
                        "description": "Usu√°rio n√£o encontrado"
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "Usu√°rio atualizado com sucesso"
                    }
                }
            }
        },
        "/users/avatar": {
            "patch": {
                "summary": "Atualiza o avatar do usu√°rio",
                "description": "Envia um arquivo com extens√£o jpeg, jpg, png ou gif para atualizar o avatar do usu√°rio",
                "tags": [
                    "Users"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "avatar": {
                                        "type": "string",
                                        "format": "binary",
                                        "description": "Arquivo do avatar do usu√°rio"
                                    }
                                },
                                "required": [
                                    "avatar"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Ok",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "$ref": "#/components/schemas/FullUserDataResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Apenas imagens com extens√£o jpeg, jpg, png ou gif s√£o permitidas."
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/sessions": {
            "post": {
                "summary": "Cria uma sess√£o para o usu√°rio",
                "description": "Gera um token para um usu√°rio j√° cadastrado com tempo de expira√ß√£o de 1 dia e com a chave secreta, que √© usada para verificar e assinar o token, garantindo autenticidade da sess√£o do usu√°rio na aplica√ß√£o. Para gerar esse token √© necess√°rio que o usu√°rio envie no corpo da requisi√ß√£o os dados de email e password.",
                "tags": [
                    "Sessions"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UserLogin"
                            },
                            "examples": {
                                "user": {
                                    "value": {
                                        "email": "arthur@email.com",
                                        "password": "123456"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "401": {
                        "description": "E-mail e/ou senha incorreta"
                    },
                    "200": {
                        "description": "Ok",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "$ref": "#/components/schemas/LoggedUser"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/movie_notes": {
            "post": {
                "summary": "Cria anota√ß√µes relacionadas ao filme feitas por um usu√°rio autenticado",
                "description": "Cria anota√ß√µes relacionadas ao filme a partir da valida√ß√£o de seu t√≠tulo, descri√ß√£o, classifi√ß√£o e tags (categorias) relacionadas a ele armazenando a anota√ß√£o no banco de dados na tabela movie_notes, al√©m de tamb√©m associar tags informadas √† anota√ß√£o na tabela movie_tags.",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/MovieNoteRegister"
                            },
                            "examples": {
                                "movie_note": {
                                    "value": {
                                        "title": "Sharknado",
                                        "description": "Os sobreviventes do primeiro tornado de tubar√µes s√£o obrigados a se reunir mais uma vez para combater uma nova tempestade de tubar√µes, que dessa vez amea√ßa Nova York.",
                                        "rating": 5,
                                        "tags": [
                                            "Terror",
                                            "A√ß√£o",
                                            "Com√©dia"
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Ok"
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "get": {
                "summary": "Lista as notas sobre os filmes com filtros no t√≠tulo e tags",
                "description": "Lista notas com filtros a partir do t√≠tulo e das tags passadas na URL como par√¢metros, chamados de par√¢metros de consulta (Query Params).",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "title",
                        "in": "query",
                        "description": "T√≠tulo do filme para busca",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "tags",
                        "in": "query",
                        "description": "Categoria do filme para busca",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Ok",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "$ref": "#/components/schemas/MovieNoteWithTags"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/movie_notes/{id}": {
            "get": {
                "summary": "Retorna dados das anota√ß√µes de filmes pelo identificador",
                "description": "Recupera anota√ß√µes espec√≠ficas pelo identificador da anota√ß√£o do filme passado por par√¢metro (Route Params). A requisi√ß√£o vai retornar a nota do filme (t√≠tulo, descri√ß√£o, classifica√ß√£o e as categorias criadas) se for bem sucedida.",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Identificador da nota do filme para busca",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Ok",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "$ref": "#/components/schemas/MovieNoteWithTags"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Deleta a nota do filme a partir do seu identificador",
                "description": "A requisi√ß√£o de delete vai apagar a nota do filme a partir do ID passado no par√¢metro da rota, deletando tamb√©m em cascata o que for vinculado a esse ID na tabela movie_tags",
                "tags": [
                    "Movie_notes"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": 1,
                        "in": "params",
                        "description": "Identificador da nota do filme para exclus√£o"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Ok"
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/movie_tags": {
            "get": {
                "summary": "Retorna as tags (categorias de filmes) vinculadas ao usu√°rio autenticado",
                "description": "Recupera as tags vinculadas ao usu√°rio com sess√£o realizada que fez a solicita√ß√£o",
                "tags": [
                    "Movie_tags"
                ],
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Ok",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/MovieTags"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Requisi√ß√£o inv√°lida",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Error"
                                },
                                "examples": {
                                    "Unauthorized": {
                                        "summary": "JWT Token n√£o informado",
                                        "value": {
                                            "status": "Error",
                                            "message": "O usu√°rio precisa ter feito a sess√£o (login) para atualizar"
                                        }
                                    },
                                    "InvalidToken": {
                                        "summary": "JWT Token inv√°lido",
                                        "value": {
                                            "status": "Error",
                                            "message": "O formato do token de autentica√ß√£o se encontra inv√°lido"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/files/{image}": {
            "get": {
                "summary": "Retorna a foto do avatar do usu√°rio salvo depois de atualizar seu avatar",
                "description": "Mostra a imagem salva do usu√°rio  partir do nome da imagem passada por par√¢metro.",
                "tags": ["Files"],
                "parameters": [
                    {
                        "name": "image",
                        "in": "path",
                        "description": "Nome da imagem do avatar do usu√°rio que foi salva.",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ]
            }
        }
    },
    "components": {
        "schemas": {
            "FullUserDataResponse": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "integer"
                    },
                    "name": {
                        "type": "string"
                    },
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "avatar": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            },
            "UserRegister": {
                "type": "object",
                "required": [
                    "name",
                    "email",
                    "password"
                ],
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                }
            },
            "UserLogin": {
                "type": "object",
                "properties": {
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                }
            },
            "UserUpdate": {
                "type": "object",
                "required": [
                    "name",
                    "email",
                    "password",
                    "old_password"
                ],
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "old_password": {
                        "type": "string"
                    }
                }
            },
            "LoggedUser": {
                "type": "object",
                "properties": {
                    "user": {
                        "$ref": "#/components/schemas/FullUserDataResponse"
                    },
                    "token": {
                        "type": "string"
                    }
                }
            },
            "MovieNoteRegister": {
                "type": "object",
                "required": [
                    "title",
                    "rating",
                    "tags"
                ],
                "properties": {
                    "title": {
                        "type": "string",
                        "required": "true"
                    },
                    "description": {
                        "type": "string"
                    },
                    "rating": {
                        "type": "integer",
                        "required": "true"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "required": "true"
                        },
                        "required": "true"
                    }
                }
            },
            "MovieTags": {
                "type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "id": {
                            "type": "integer"
                        },
                        "note_id": {
                            "type": "integer"
                        },
                        "user_id": {
                            "type": "integer"
                        },
                        "name": {
                            "type": "string"
                        }
                    }
                }
            },
            "MovieNoteWithTags": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "rating": {
                        "type": "integer"
                    },
                    "user_id": {
                        "type": "integer"
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updated_at": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "movie_tags": {
                        "$ref": "#/components/schemas/MovieTags"
                    }
                }
            },
            "Error": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            }
        },
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "scheme": "bearer",
                "bearerFormat": "JWT"
            }
        }
    }
}